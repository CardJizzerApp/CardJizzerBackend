variables:
    IMAGE_NAME: "mypenink/cah-backend"
    EXPOSE_PORT: 30001
    CONTAINER_NAME: "CAH-Backend"
    CONTAINER_PORT: 80
    
stages:
    - build
    - deploy

build:
    stage: build
    script:
        - docker build -t $IMAGE_NAME .
        - docker login -u mypenink -p $docker_pw
        - docker push $IMAGE_NAME


deploy:
    stage: deploy
    script:
        - docker rm -f $CONTAINER_NAME || true
        - docker rmi -f $IMAGE_NAME || true
        - docker run -d -p $EXPOSE_PORT:$CONTAINER_PORT --name $CONTAINER_NAME $IMAGE_NAME